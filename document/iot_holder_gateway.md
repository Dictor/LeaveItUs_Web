# 보관함-게이트웨이 개발 문서
## 현재 보관함와 게이트웨이 작동 방식의 등장
현재 군에서 적용하는 방식은 중앙화되어 당직사관의 성향에 따라 반납이 유동적으로 이루어진다. 사관에 따라 미인가 휴대폰을 제출하거나, 아예 제출을 안 하는 경우가 발생한다. 
이런 문제점을 해결하기 위해 휴대폰을 비대면으로 반납할 방법을 모색하던 중, 방법이 떠올랐다.

- **1)**	기존에 휴대폰 뒤에 붙이던 등록 필증은 가지고 있는지 여부밖에 확인 안 한다. 즉, 등록 필증과 붙어 있는 휴대폰이 체계에 등록된 사항과 일치하는지 아니면 필증만 붙어있는 것인지 현재 확인하는 바가 없다. 따라서, 등록 필증에 붙어있는 숫자는 의미가 없다. 이 문제점을 휴대폰에 NFC 태그를 부착하고 불출 혹은 반납할 때 태그를 찍고 체계에 알리는 방식으로 보완하는 것이다. 이 방식으로 했을 때 해결되는 문제는 다음과 같다.
  
    - **A.**	반출된 휴대전화의 Tag를 공기계에 붙일 수 없다. 따라서 군 내에 돌아다니는 Tag는 오직 정식 인가된 장비의 Tag밖에 없을 것이다.
    - **B.**	반납 시간에 tag를 안 찍고 휴대전화를 반납하지 않는 상황을 방지할 수 있다. Tag를 안 찍는다면 체계에서 미반납된 휴대전화로 알림이 갈 것이기 때문이다.
    
- **2)**	1)-B에서 Tag를 찍고 반납을 안 하는 경우를 방지하기 위해서 휴대폰 보관함의 각 보관 칸에 무게를 잴 수 있는 센서를 부착하는 것이다. 그리고 반납 시 무게의 차이가 심한 보관 칸의 경우 비정상 반납으로 체계에 알리는 것이다. 이 방식을 도입할 경우 해결되는 문제는 다음과 같다.
  
   - **A.**	미반납(무게 측정 값0g)과 다른 휴대전화 반납(무게 값 오차범위 밖)을 할 수 없게 된다.
    
- **3)**	만약 아무도 없는 시간에 몰래 휴대전화를 꺼낼려고 한다면 방범용을 설치하는 개폐센서를 보관함 문에도 설치한다면 문을 열어서 휴대폰을 불출하는 문제를 방지할 수 있을 것이다.
 
## 휴대폰 보관함 시스템의 개발 중점(문제점과 해결 방안)
- **1)**	각 보관함은 각 생활관에 배치되어야 한다. 또한 각 보관함은 어떤 방식으로든 서버와 연결되어 정보를 주고 받아야한다. 하지만 생활관에 있는 외부망을 사용하는 기가지니와 내부방을 사용해야 하는 휴대폰 보관함은 *각각 다른 LAN선을 필요로 한다*. 이는 보관함을 설치하기 위해서는 새로운 LAN선 매설을 뜻하고 이는 효과적인 방안이 아니다

    -> 따라서 이 문제는 **저전력, 장거리 통신 규격인 LoRa**로 해결했다. LoRa는 다른 무선통신 규격에 비해 초기 설치비용도 적고 유지비용도 들지 않는 장점이 있다.
 
- **2)**	LoRa 노드가 각자 unique한 네트워크 주소를 가져야 게이트웨이에서 네트워크 주소를 지정해 데이터를 보내기 좋고 안정성이 있다. 그러나 보관함을 ide에 연결하여 코드수정을 통해 각 보관함에 맞는 주소를 설정해줘야 한다. 이는 *LoRa 노드의 독립성이 떨어져 유지 보수하는데 어려워진다.* 

    -> 따라서 이 문제를 해결하기 위해서는 **네트워크 주소를 하나로 통일하고 보관함 UID를 공정에서 hardcoding한다**. 그리고 그 UID를 각 보관함 노드의 데이터와 함께 보내고 받음으로써 데이터를 정확한 노드에 보낼 수 있다. (같은 네트워크 주소를 공유할 수 있다.)

- **3)**	아두이노 우노를 사용한 *게이트웨이는 채널이 하나 밖에 없다. 따라서 동시에 데이터를 게이트웨이로 보내면 한쪽은 데이터를 유실하게 된다.* 비싼 게이트웨이를 사용한다면 멀티채널이 가능하지만 그것은 초기 설치 비용이 늘어난다. 

    ->이것을 해결하기 위해 각 보관함 노드들이 10초에서 20초 사이에 **랜덤으로 데이터를 보냄**으로써 싱글 채널 문제를 해결했다.

